name: Daily Donchian Signal

on:
  schedule:
    - cron: '5 22 * * 1-4'  # 22:05 UTC Monâ€“Thu (Fri skipped: weekend spread risk)
  workflow_dispatch:          # Manual trigger button in GitHub UI for testing

jobs:
  run-signal:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: grep -v "^pandas-ta" requirements.txt | pip install -r /dev/stdin

      - name: Write OANDA config
        env:
          OANDA_API_TOKEN: ${{ secrets.OANDA_API_TOKEN_PRACTICE }}
          OANDA_ACCOUNT_ID: "101-004-28715689-001" # Practice account ID
        run: |
          mkdir -p config
          {
            echo "[practice]"
            echo "api_token = $OANDA_API_TOKEN"
            echo "account_id = $OANDA_ACCOUNT_ID"
            echo ""
            echo "[settings]"
            echo "base_url_practice = https://api-fxpractice.oanda.com"
            echo "base_url_live = https://api-fxtrade.oanda.com"
          } > config/oanda_config.ini

      - name: Run signal detector
        run: python run_daily.py --practice
